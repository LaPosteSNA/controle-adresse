/*
 *  Services adresses La Poste SNA
 *  serca-form - v0.0.1
 *  Interface de demonstration des services adresses Serca.
 *  Copyright 2017-2019 La Poste SNA
 *  Licensed under MIT
 */

if("undefined"==typeof jQuery)throw new Error('Le plugin "sercaForm" nécessite jQuery!');!function(f){"use strict";var n,d,s="&hlDebut=<strong>&hlFin=</strong>",o="&hlDebutRestruct=<p class='color_red'>&hlFinRestruct=</p>";f.fn.setOptionTitle=function(e){var a="";return void 0!==e&&0<e.length&&(a="<h1>"+e+"</h1>"),a},f.fn.retrieveAddressFromSerca=function(e,a,r){var s,o;return s="address_row8"==a?e.suggest.slice(0,r.nbDisplayedResults):e.reponse.adresse.slice(0,r.nbDisplayedResults),"address_row6"==a&&(o=s.map(function(e){return{value:e.ligne6.codePostal+" "+e.ligne6.libelleAcheminement,highlightedResult:f.fn.getHighlightedResult(e.cea,a,e,r),address_row1:"",address_row2:"",address_row3:"",address_row4:"",address_row5:""!==e.ligne5.libelle?e.ligne5.libelle:"",address_row6:e.ligne6.codePostal+" "+e.ligne6.libelleAcheminement,address_row7:"",insee_code:e.ligne6.codeInsee,libelle_acheminement:e.ligne6.libelleAcheminement}})),"address_row5"==a&&(o=s.map(function(e){return{value:e.ligne6.codePostal+" "+e.ligne6.libelleAcheminement,highlightedResult:f.fn.getHighlightedResult(e.cea,a,e,r),address_row1:"",address_row2:"",address_row3:"",address_row4:"",address_row5:""!==e.ligne6.libelle?e.ligne6.libelle:"",address_row6:e.ligne6.codePostal+" "+e.ligne6.libelleAcheminement,address_row7:"",insee_code:e.ligne6.codeInsee,libelle_acheminement:e.ligne6.libelleAcheminement}})),"address_row4"==a&&(d=f.fn.analyseIsMultiCP(s),o=s.map(function(e){return{value:e.ligne4.libelle,highlightedResult:f.fn.getHighlightedResult(e.cea,a,e,r),address_row1:"",address_row2:"",address_row3:"",address_row4:e.ligne4.libelle,address_row5:""!==e.ligne5.libelle?e.ligne5.libelle:"",address_row6:e.ligne6.codePostal+" "+e.ligne6.libelleAcheminement,address_row7:"",numext:e.ligne4.numero+(""!==e.ligne4.extLongue?" "+e.ligne4.extLongue:""),justVoieaddress_row4:e.ligne4.libelleVoie}})),"address_row3"==a&&(o=s.map(function(e){return void 0!==e.ligne3?{value:e.ligne3.libelle,highlightedResult:f.fn.getHighlightedResult(e.cea,a,e,r),address_row1:"",address_row2:"",address_row3:""!==e.ligne3.libelle?e.ligne3.libelle:"",address_row4:e.ligne4.libelle,address_row5:""!==e.ligne5.libelle?e.ligne5.libelle:"",address_row6:e.ligne6.codePostal+" "+e.ligne6.libelleAcheminement,address_row7:"",insee_code:e.ligne3.codeInsee}:{value:"",highlightedResult:'<li><div class="address-autocomplete-result-list address-autocomplete-result-list-style-'+r.autocompleteListStyle+'" + address-autocomplete-result-list-style-empty" id="9999">Aucune Proposition...</div></li>',address_row1:"",address_row2:"",address_row3:"",address_row4:"",address_row5:"",address_row6:"",address_row7:"",insee_code:"-1"}})),"address_row8"==a&&(o=s.map(function(e){return{value:e,highlightedResult:f.fn.getHighlightedResult(e.cea,a,e,r),address_row8:e}})),o},f.fn.compareVilles=function(e,a){return e.libelleAcheminement==a.libelleAcheminement&&e.codeInsee==a.codeInsee&&e.codePostal!=a.codePostal},f.fn.analyseIsMultiCP=function(e){for(var a=[],r=0;r<e.length;r++)for(var s=e[r].ligne6,o=0;o<e.length;o++){var d=e[o].ligne6;r!=o&&f.fn.compareVilles(s,d)&&-1==a.indexOf(s.libelleAcheminement)&&a.push(s.libelleAcheminement)}return a},f.fn.retrieveAddressFromSercaMascadia=function(e,a,r){var s,o;switch(a){case"address_row8":s=e,f("#row8_message").hide(),f("#address_row8").removeClass("is-valid"),f("#address_row8").removeClass("is-invalid"),f("#address_row8").removeClass("is-warning");var d=f("#address_row8");"error"==(o=f.fn.analyse_reponse(e)).state?(d.addClass("is-invalid"),f("#row8_message").css("color","red"),f("#row8_message").text(o.msg),f("#row8_message").show()):"warning"==o.state?(d.addClass("is-warning"),f("#row8_message").css("color","orange"),f("#row8_message").text(o.msg),f("#row8_message").show()):"success"==o.state&&d.addClass("is-valid");break;case"address_row9":f("#address_row9").removeClass("is-valid"),f("#address_row9").removeClass("is-invalid");var i=f("#address_row9");0==(o=f.fn.dqephone_check(e)).status?i.addClass("is-invalid"):1==o.status&&(i.addClass("is-valid"),f("#address_row9").val(o.Tel));break;case"controler_votre_adresse":s=e.retour.blocAdresse.adresse.slice(0,r.nbDisplayedResults);var n=e.retour.codesEtMessages;if(0<s.length){f("#address_row2").val(s[0].ligne2.value).change(),f("#address_row3").val(s[0].ligne3.value).change(),f("#address_row4").val(s[0].ligne4.value).change(),f("#address_row5").val(""!==s[0].ligne5.value?s[0].ligne5.value:"").change(),f("#address_row6").val(s[0].ligne6.codePostal+" "+s[0].ligne6.libelleAcheminement).change(),f("#address_row7").val(s[0].ligne7.value).change(),f("#address_row6").removeClass("is-valid"),f("#address_row5").removeClass("is-valid"),f("#address_row4").removeClass("is-valid"),f("#address_row3").removeClass("is-valid"),f("#address_row2").removeClass("is-valid"),f("#address_row6").removeClass("is-invalid"),f("#address_row5").removeClass("is-invalid"),f("#address_row4").removeClass("is-invalid"),f("#address_row3").removeClass("is-invalid"),f("#address_row2").removeClass("is-invalid"),f("#address_row6").removeClass("is-warning"),f("#address_row5").removeClass("is-warning"),f("#address_row4").removeClass("is-warning"),f("#address_row3").removeClass("is-warning"),f("#address_row2").removeClass("is-warning");var l=f("#address_row6"),t=f("#address_row5"),c=f("#address_row4"),u=f("#address_row3"),m=f("#address_row2");[{feu:n.ligne6.feu,row:l},{feu:n.ligne5.feu,row:t},{feu:n.ligne4.feu,row:c},{feu:n.ligne3.feu,row:u},{feu:n.ligne2.feu,row:m}].forEach(function(e){if(""!==e.row.val())switch(e.feu){case"-2":e.row.addClass("is-invalid");break;case"-1":e.row.addClass("is-warning");break;case"0":e.row.addClass("is-valid")}})}}f.fn.updateFinal()},f.fn.getSercaURL=function(e,a,r){var s="",o="?chaineRecherche=%strSearch%&typeRecherche=commune&nbItems="+r.nbDisplayedResults+"&optionMot=CommencePar&optionRecherche=AND_OR&typeResultat=json",d="?chaineRecherche=%strSearch%&typeRecherche=commune&nbItems="+r.nbDisplayedResults+"&optionMot=CommencePar&optionRecherche=AND_OR&typeResultat=json",i="?chaineRecherche=%strSearch%&nbItems="+r.nbDisplayedResults+"&optionFiltre=code_insee=%strCodeInsee%&typeRecherche=voie;pdi&optionMot=CommencePar&optionRecherche=AND_OR&typeResultat=json",n="?chaineRecherche=%strSearch%&nbItems="+r.nbDisplayedResults+"&optionFiltre=libelle_acheminement=%strLibAch%&typeRecherche=voie;pdi&optionMot=CommencePar&optionRecherche=AND_OR&typeResultat=json",l="?chaineRecherche=%strSearch%&nbItems="+r.nbDisplayedResults+"&optionFiltre=libelle_voie=%strlibVoie%&optionFiltre=numero_ext=%strNumExt%&optionFiltre=libelle_acheminement=%strLibAch%&typeRecherche=ligne3&optionMot=CommencePar&optionRecherche=AND_OR&typeResultat=json",t="?prenom=&civilite=&nom=&ligne2="+f("#address_row2").val()+"&ligne3="+f("#address_row3").val()+"&ligne4="+f("#address_row4").val()+"&ligne5="+f("#address_row5").val()+"&ligne6="+f("#address_row6").val()+"&ligne7=&typeResultat=json",c="?Email=%email%&Nom=%nom%&Prenom=%prenom%&Pays=%country%&Instance=0",u="?Email=%email%&checkuser=%checkuser%&extendedsyntax=%syntax%&Rectify=%rectify%",m="?Tel=%telephone%&Pays=%pays%&Format=%format%";switch(a){case"address_row6":return s=(s=(r.corpsProxy||"")+r.distantDNSSolr+d).replace("%strSearch%",e);case"address_row5":return s=(s=(r.corpsProxy||"")+r.distantDNSSolr+o).replace("%strSearch%",e);case"address_row4_insee_code":return s=(s=(s=(r.corpsProxy||"")+r.distantDNSSolr+i).replace("%strSearch%",e)).replace("%strCodeInsee%",f("#address_row6").attr("insee_code"));case"address_row4_acheminement_label":return s=(s=(s=(r.corpsProxy||"")+r.distantDNSSolr+n).replace("%strSearch%",e)).replace("%strLibAch%",f("#address_row6").attr("libelle_acheminement"));case"address_row3":return s=(r.corpsProxy||"")+r.distantDNSSolr+l,""==e&&(e=f("#address_row4").attr("numext")+" "+f("#address_row4").attr("voie")),s=(s=(s=(s=s.replace("%strSearch%",e)).replace("%strlibVoie%",f("#address_row4").attr("voie"))).replace("%strNumExt%",f("#address_row4").attr("numext"))).replace("%strLibAch%",f("#address_row6").attr("libelle_acheminement"));case"controler_votre_adresse":return s=(s=(r.corpsProxy||"")+r.distantDNSMascadia+t).replace("%strSearch%",e);case"address_row8_autocompletion":return s=(s=(s=(s=(s=(r.corpsProxy||"")+r.distantDQEAutocompletionMail+c).replace("%email%",f.fn.removeAccents(f("#address_row8").val()))).replace("%nom%",f("#address_row1_last_name").val())).replace("%prenom%",f("#address_row1_first_name").val())).replace("%country%",f.fn.dqemail().country);case"controler_votre_mail":return s=(s=(s=(s=(s=(s=(r.corpsProxy||"")+r.distantDQEMail+u).replace("%strSearch%",e)).replace("%email%",f.fn.removeAccents(f("#address_row8").val()))).replace("%rectify%",f.fn.dqemail().rectify)).replace("%syntax%",f.fn.dqemail().extended)).replace("%checkuser%",f.fn.dqemail().checkuser);case"controler_votre_telephone":return s=(s=(s=(s=(r.corpsProxy||"")+r.distantDQETelephone+m).replace("%telephone%",f("#address_row9").val())).replace("%format%",f.fn.dqephone_options().format)).replace("%pays%",f.fn.dqephone_options().country)}},f.fn.getHighlightedResult=function(e,a,r,s){var o="";return o=o+'<li><div class="address-autocomplete-result-list address-autocomplete-result-list-style-'+s.autocompleteListStyle+'" id="'+e+'">',"address_row6"==a&&(o+=r.ligne6.highlight,""!==r.ligne5.libelle&&(o+='<br/><span class="text-muted">'+r.ligne5.libelle+"</span>")),"address_row4"==a&&(o+=r.ligne4.highlight,""!==r.ligne5.libelle?(o+='<br/><span class="text-muted">'+r.ligne5.libelle+"</span>",""===r.ligne4.numero&&(o+=', <span class="text-muted">'+r.ligne6.codePostal+" "+r.ligne6.libelleAcheminement+"</span>")):"PARIS"!==r.ligne6.libelleAcheminement&&"LYON"!==r.ligne6.libelleAcheminement&&"MARSEILLE"!==r.ligne6.libelleAcheminement&&-1==d.indexOf(r.ligne6.libelleAcheminement)||(o+='<br/><span class="text-muted">'+r.ligne6.codePostal+" "+r.ligne6.libelleAcheminement+"</span>")),"address_row3"==a&&(o+=r.ligne3.libelle+'<br /><span class="text-muted">'+(r.ligne4.numero+" "+r.ligne4.extLongue+" "+r.ligne4.libelleVoie).trim()+", "+r.ligne6.codePostal+" "+r.ligne6.libelleAcheminement+"</span>"),"address_row8"==a&&(o+=r),o+="</div></li>"},f.fn.getHtmlForm=function(e){var a="",r="";if("bootstrap4"===e.ihmModelAndVersion){a='<form id="address-autocomplete-form" class="containerca p-5" autocomplete="off" action="" method="POST">\n'+f.fn.setOptionTitle(e.title);if(e.oneFieldAddressRow1)r='<div class="form-group row form-space">\n    <label id="address_row1_label" for="address_row1" class="col-md-4 col-form-label">Prénom Nom</label>\n    <div class="col-md-8"><div class="input-group-btn">\n        <input type="input" tabindex="1" class="form-control" id="address_row1" name="address_row1" maxlength="38" aria-describedby="Prénom Nom" placeholder="Ex: Jean Dupond" autocomplete="off">\n    </div></div>\n</div>\n';else{r='<div class="form-group row form-space">\n    <div class="col-md-4  col-form-label">'+("first_name;last_name"==e.orderFieldAddressRow1?'<label id="address_row1_firstname_label" for="address_row1_first_name" class=" col-form-label">Prénom</label> - <label id="address_row1_lastname_name_label" for="address_row1_last_name" class="col-form-label">Nom</label> :':'<label id="address_row1_lastname_name_label" for="address_row1_last_name">Nom </label> - <label id="address_row1_firstname_label" for="address_row1_first_name">Prénom <font color="red">*</font></label> :')+'</div>\n    <div class="col-md-8" id="address_row1"><div class="input-group">\n',"first_name;last_name"==e.orderFieldAddressRow1?(r+='        <input type="input" tabindex="1" class="form-control" xwidth="50%" id="address_row1_first_name" name="address_row1_first_name" maxlength="38" aria-describedby="Prénom" placeholder="Ex : Dupont" autocomplete="off">\n',r+='        <input type="input" tabindex="2" class="form-control" xwidth="50%" id="address_row1_last_name" name="address_row1_last_name" maxlength="38" aria-describedby="Nom" placeholder="Ex : Dominique" autocomplete="off">\n'):(r+='        <input type="input" tabindex="1" class="form-control" xwidth="50%" id="address_row1_last_name" name="address_row1_first_name" maxlength="38" aria-describedby="Nom" placeholder="Ex : Dupont" autocomplete="off"><span style="width:5%"></span>\n',r+='        <input type="input" tabindex="2" class="form-control" xwidth="50%" id="address_row1_first_name" name="address_row1_last_name" maxlength="38" aria-describedby="Prénom" placeholder="Ex : Dominique" autocomplete="off">\n'),r+="    </div></div>\n</div>\n"}a=a+'\t<div class="text-right mb-5" id="information"><font color="red">*</font> Champs obligatoires</div>\n<div class="form-group row">\n    <label id="address_row0_label" class="col-md-4 col-form-label" for="address_row1_gender">Civilité :</label>\n    <div class="col-md-8 d-inline-flex align-items-center">\n    <div class="form-check col-md-4 pl-0">\n            <input class="form-check-input" type="checkbox" name="address_row1_gender" id="address_row1_male" value="M" autocomplete="off"> \n        <label class="form-check-label ml-4" id="gender" for="address_row1_male">Monsieur</label>\n     </div>\n    <div class="form-check col-md-4 pl-0">\n            <input class="form-check-input" type="checkbox" name="address_row1_gender" id="address_row1_female" value="MME" autocomplete="off"> \n        <label class="form-check-label ml-4" for="address_row1_female">Madame</label>\n     </div>\n    </div>\n</div>\n'+r+'<div class="form-group row form-space">\n    <label id="address_row6_label" for="address_row6" class="col-md-4 col-form-label">Code Postal - Localité <font color="red">*</font> :</label>\n    <div class="col-md-8">\n        <input type="input" tabindex="2" class="form-control" id="address_row6" name="address_row6" maxlength="38"  aria-describedby="Code Postal - ville" placeholder="Ex : 33500 Libourne" autocomplete="off"><i class="fa fa-circle-o-notch fa-spin text-primary hide loading" aria-hidden="true"></i>\n        <div id="address_row6Help" class="invalid-feedback"></i></div>\n        <div class="valid-feedback feedback-icon" id="address_row6-valid">\n        <i class="fa fa-check"></i>\n        </div>\n        <div class="invalid-feedback feedback-icon" id="address_row6-invalid">\n        <i class="fa fa-minus-circle"></i>\n        </div>\n        <div class="warning-feedback feedback-icon" id="address_row6-warning">\n        <i class="fa fa-exclamation-circle"></i>\n\t\t</div>\n    </div>\n</div>\n<div class="form-group row form-space">\n    <label id="address_row5_label" for="address_row5" class="col-md-4 col-form-label">Lieu dit ou Ancienne Commune :</label>\n    <div class="col-md-8">\n        <input type="input" tabindex="3" class="form-control" id="address_row5" name="address_row5" maxlength="38" aria-describedby="Lieu dit ou ancienne commune" placeholder="" autocomplete="off"><i class="fa fa-circle-o-notch fa-spin text-primary hide loading" aria-hidden="true"></i>\n        <div id="address_row5Help" class="invalid-feedback"></i></div>\n        <div class="valid-feedback feedback-icon" id="address_row5-valid">\n        <i class="fa fa-check"></i>\n        </div>\n        <div class="invalid-feedback feedback-icon" id="address_row5-invalid">\n        <i class="fa fa-minus-circle"></i>\n\t\t</div>\n        <div class="warning-feedback feedback-icon" id="address_row5-warning">\n        <i class="fa fa-exclamation-circle"></i>\n\t\t</div>\n   </div>\n</div>\n<div class="form-group row form-space has-feedback">\n    <label id="address_row4_label" for="address_row4" class="col-md-4 col-form-label">Numéro et Nom de la voie <font color="red">*</font> :</label>\n    <div class="col-md-8">\n        <input type="input" tabindex="4" class="form-control" id="address_row4" name="address_row4" maxlength="38" aria-describedby="Numéro et nom de la voie" placeholder="Ex : 3 rue des lilas" autocomplete="off"><i class="fa fa-circle-o-notch fa-spin text-primary hide loading" aria-hidden="true"></i>\n        <div id="address_row4Help" class="invalid-feedback"></div>\n        <div class="valid-feedback feedback-icon" id="address_row4-valid">\n        <i class="fa fa-check"></i>\n        </div>\n        <div class="invalid-feedback feedback-icon" id="address_row4-invalid">\n        <i class="fa fa-minus-circle"></i>\n\t\t</div>\n        <div class="warning-feedback feedback-icon" id="address_row4-warning">\n        <i class="fa fa-exclamation-circle"></i>\n\t\t</div>\n    </div>\n</div>\n<div class="form-group row form-space has-feedback">\n    <label id="address_row3_label" for="address_row3" class="col-md-4 col-form-label">Bâtiment, résidence :</label>\n    <div class="col-md-8">\n        <input type="input" tabindex="5" class="form-control" id="address_row3" name="address_row3" maxlength="38" aria-describedby="Bâtiment, résidence" placeholder="Ex : Residence la verboise" autocomplete="off"><i class="fa fa-circle-o-notch fa-spin text-primary hide loading" aria-hidden="true"></i>\n        <div id="address_row3Help" class="invalid-feedback"></div>\n        <div class="valid-feedback feedback-icon" id="address_row3-valid">\n        <i class="fa fa-check"></i>\n        </div>\n        <div class="invalid-feedback feedback-icon" id="address_row3-invalid" >\n        <i class="fa fa-minus-circle"></i>\n        </div>\n        <div class="warning-feedback feedback-icon" id="address_row3-warning">\n        <i class="fa fa-exclamation-circle"></i>\n\t\t</div>\n    </div>\n</div>\n<div class="form-group row form-space has-feedback">\n    <label id="address_row2_label" for="address_row2" class="col-md-4 col-form-label">Appartement, Escalier, Etage :</label>\n    <div class="col-md-8">\n        <input type="input" tabindex="6" class="form-control" id="address_row2" name="address_row2" maxlength="38" aria-describedby="Appartement, Escalier, Etage" placeholder="Ex : Appartement 123" autocomplete="off">\n        <div id="address_row2Help" class="invalid-feedback"></div>\n        <div class="valid-feedback feedback-icon" id="address_row2-valid">\n        <i class="fa fa-check"></i>\n        </div>\n        <div class="invalid-feedback feedback-icon" id="address_row2-invalid" >\n        <i class="fa fa-minus-circle"></i>\n        </div>\n        <div class="warning-feedback feedback-icon" id="address_row2-warning">\n        <i class="fa fa-exclamation-circle"></i>\n\t\t</div>\n    </div>\n</div>\n<div class="form-group form-space row">\n    <label id="address_row9_label" for="address_row9" class="col-md-4 col-form-label">Téléphone :</label>\n    <div class="col-md-8">\n        <input type="input" tabindex="2" class="form-control" id="address_row9" name="address_row9" maxlength="38" aria-describedby="Téléphone" placeholder="EX : 0102030405" autocomplete="off">\n         <div id="address_row9Help" class="invalid-feedback"></div>\n        <div class="valid-feedback feedback-icon" id="address_row9-valid">\n        <i class="fa fa-check"></i>\n        </div>\n        <div class="invalid-feedback feedback-icon" id="address_row9-invalid" >\n        <i class="fa fa-minus-circle"></i>\n        </div>\n    </div>\n</div>\n<div class="form-group form-space row" >\n    <label id="address_row8_label" for="address_row8" class="col-md-4 col-form-label">E-mail :</label>\n    <div class="col-md-8" id="row8">\n        <input type="input" tabindex="2" class="form-control" id="address_row8" name="address_row8" maxlength="38" aria-describedby="Email" placeholder="EX : dominique.dupont@laposte.fr" autocomplete="off"><i class="fa fa-circle-o-notch fa-spin text-primary hide loading" aria-hidden="true"></i>\n\t\t <div id="address_row8Help" class="invalid-feedback"></div>\n        <div class="valid-feedback feedback-icon" id="address_row8-valid">\n        <i class="fa fa-check"></i>\n        </div>\n        <div class="invalid-feedback feedback-icon" style="margin-bottom:23px" id="address_row8-invalid" >\n        <i class="fa fa-minus-circle"></i>\n        </div>\n        <div class="warning-feedback feedback-icon" style="margin-bottom:23px"  id="address_row8-warning">\n        <i class="fa fa-exclamation-circle" ></i>\n\t\t</div>\n\t\t<span id="row8_message" value=""></span>\n    </div>\n</div>\n<div class="form-group form-space row has-feedback m-0">\n    <div class="col-md-12 d-flex flex-row-reverse flex-wrap justify-content-start">\n        <button class="btn  btn-secondary font-weight-bold btn-lg float-center" style="float:right" disabled tabindex="7" title="Effectue une RNVP sur la l\'adresse saisie\net affiche des indicateurs en retour." id="btn_validate" type="submit">VALIDER VOTRE SAISIE</button>\n\t\t <button class="btn btn-success btn-lg font-weight-bold float-center" style="float:right" disabled type="button" id="controler_votre_adresse" title="Controler votre addresse." >CONTRÔLER VOTRE ADRESSE</button>\n        <button class="btn float-center" type="reset" id="btn_clear" style="float:right;" title="Efface le contenu du formulaire."><i class="fas fa-redo"></i>&nbsp;&nbsp;EFFACER</button>\n        <button class="btn btn-primary" tabindex="8" type="button" id="btn_copy" role="WholeAdrClipboard" title="Copie l\'adresse dans le presse-papier." class="collapse">Copier l\'adresse complète</button>\n    </div>\n</div>\n</form>\n'}return a},f.fn.updateFinal=function(){var e="",a={};return n.upperCaseFields&&f("form").find("input[type=input], input[type=password], textarea").each(function(){f(":input").each(function(){this.value=this.value.toUpperCase()})}),n.oneFieldAddressRow1?(e+=""!==f("input:radio:checked").val()?f("input:radio:checked").val()+" ":"",e+=""!==f("#address_row1").val()?f("#address_row1").val()+"\n":"",""==f("#address_row1").val()&&(e="",a.address_row1="")):(e+=""!==f("input:radio:checked").val()?f("input:radio:checked").val()+" ":"","first_name;last_name"==n.orderFieldAddressRow1?(e+=""!==f("#address_row1_first_name").val()?f("#address_row1_first_name").val()+" ":"",e+=""!==f("#address_row1_last_name").val()?f("#address_row1_last_name").val()+"\n":""):(e+=""!==f("#address_row1_last_name").val()?f("#address_row1_last_name").val()+"\n":"",e+=""!==f("#address_row1_first_name").val()?f("#address_row1_first_name").val()+" ":""),""==f("#address_row1_first_name").val()&&""==f("#address_row1_last_name").val()&&(e="",a.address_row1="")),e+=""!==f("#address_row2").val()?f("#address_row2").val()+"\n":"",a.address_row2=""!==f("#address_row2").val()?"<div title='Cliquez pour copier'>"+f("#address_row2").val()+"</div>\n":"",e+=""!==f("#address_row3").val()?f("#address_row3").val()+"\n":"",a.address_row3=""!==f("#address_row3").val()?"<div title='Cliquez pour copier'>"+f("#address_row3").val()+"</div>\n":"",e+=""!==f("#address_row4").val()?f("#address_row4").val()+"\n":"",a.address_row4=""!==f("#address_row4").val()?"<div title='Cliquez pour copier'>"+f("#address_row4").val()+"</div>\n":"",e+=""!==f("#address_row5").val()?f("#address_row5").val()+"\n":"",a.address_row5=""!==f("#address_row5").val()?"<div title='Cliquez pour copier'>"+f("#address_row5").val()+"</div>\n":"",e+=""!==f("#address_row6").val()?f("#address_row6").val()+"\n":"",a.address_row6=""!==f("#address_row6").val()?"<div title='Cliquez pour copier'>"+f("#address_row6").val()+"</div>":"",e.toUpperCase()},f.fn.getTypeAddressRow4=function(e){return-1!==["PARIS","LYON","MARSEILLE"].indexOf(e)?"address_row4_acheminement_label":"address_row4_insee_code"},f.fn.AjaxRetry=function(s,r){for(var o=window.setTimeout(function(){},0);o--;)window.clearTimeout(o);var d=0,i=function(){f.ajax({url:s.urlWS,type:"GET",datatype:"json",tryCount:d,retryLimit:n.maxRetries,timebeforeTA:n.maxRetriesTimeout,timeout:n.ajaxTimeout,crossDomain:!0,headers:{"X-Okapi-Key":f.fn.resultLicense()},beforeSend:function(){f(s.object).siblings("i").removeClass("hide")},success:function(e){var a=f.fn.retrieveAddressFromSerca(e,f(s.object)[0].id,n);clearTimeout(o),r(a)},dataFilter:function(e){var a=JSON.parse(e);if("address_row3"==f(s.object)[0].id&&""!==s.numero_address_row4)for(var r=a.reponse.adresse.length-1;0<=r;r--)a.reponse.adresse[r].ligne4.numero!==s.numero_address_row4&&a.reponse.adresse.splice(r,1);if("address_row3"==f(s.object)[0].id){a.reponse.adresse.unshift({})}return JSON.stringify(a)},error:function(e,a){if("timeout"!=a);else if(this.tryCount++,d++,this.tryCount<=this.retryLimit){var r=parseInt(this.timebeforeTA+10*this.tryCount/100*1e4);o=setTimeout(i,parseInt(r))}}}).always(function(){f(s.object).siblings("i").addClass("hide")})};i()},f.fn.AjaxRetryMascadia=function(a){for(var s=window.setTimeout(function(){},0);s--;)window.clearTimeout(s);var o=function(){f.ajax({url:a.urlWS,type:"GET",datatype:"json",tryCount:0,retryLimit:n.maxRetries,timebeforeTA:n.maxRetriesTimeout,timeout:n.ajaxTimeout,crossDomain:!0,headers:{"X-Okapi-Key":f.fn.resultLicense()},beforeSend:function(){},success:function(e){f.fn.retrieveAddressFromSercaMascadia(e,f(a.object)[0].id,n),clearTimeout(s)},dataFilter:function(e){var a=JSON.parse(e);return JSON.stringify(a)},error:function(e,a){if("timeout"!=a);else if(this.tryCount++,this.tryCount<=this.retryLimit){f("#erreur_information").remove();var r=parseInt(this.timebeforeTA+10*this.tryCount/100*1e4);s=setTimeout(o,parseInt(r))}}})};o()},f.fn.AjaxRetryMailAuto=function(r,s){for(var o=window.setTimeout(function(){},0);o--;)window.clearTimeout(o);var d=function(){f.ajax({url:r.urlWS,type:"GET",datatype:"json",tryCount:0,retryLimit:n.maxRetries,timebeforeTA:n.maxRetriesTimeout,timeout:n.ajaxTimeout,crossDomain:!0,headers:{"X-Okapi-Key":f.fn.resultLicense()},beforeSend:function(){f(r.object).siblings("i").removeClass("hide")},success:function(e){var a=f.fn.retrieveAddressFromSerca(e,f(r.object)[0].id,n);clearTimeout(o),s(a)},dataFilter:function(e){var a=JSON.parse(e);return JSON.stringify(a)},error:function(e,a){if("timeout"!=a);else if(this.tryCount++,this.tryCount<=this.retryLimit){f("#erreur_information").remove();var r=parseInt(this.timebeforeTA+10*this.tryCount/100*1e4);o=setTimeout(d,parseInt(r))}}}).always(function(){f(r.object).siblings("i").addClass("hide")})};d()},f.fn.copyToClipboard=function(e,a){var r=f("<textarea>");f("body").append(r),a?r.val(f.fn.updateFinal()).select():r.val(f(e).text()).select(),document.execCommand("copy"),r.remove()},f.fn.findWord=function(e){var a=["APPT","ESC"].indexOf(e);return-1!==a?["APPARTEMENT","ESCALIER"][a]:""},f.fn.checkExtend=function(e){for(var a="",r=e.val().toUpperCase().split(" "),s=0;s<r.length;s++){var o=f.fn.findWord(r[s]);a+=""!==o&&(a+o).length<=38?o+" ":r[s]+" "}return a},f.fn.inArray=function(e,a){for(var r=0;r<a.length;r++)if(a[r]===e)return!0;return!1},f.fn.sercaForm=function(a){this.each(function(){var e=f(this);return n=f.extend({backColor:"",upperCaseFields:!1,title:"",autocompleteListStyle:"",ihmModelAndVersion:"bootstrap4",login:"",password:"",maxRetries:3,maxRetriesTimeout:3e3,ajaxTimeout:1e3,minDelayBeforeCall:50,minLengthBeforeCall:3,autocompletion:{row3:!1,row4_number:!0,row4_road:!0,postal_code_locality:!0,cedex_id:!0},continueOnError:!0,doRnvp:!1,rnvp:{row3:!1,row4_number:!0,row4_road:!0,postal_code_locality:!0,cedex_id:!0},nbDisplayedResults:5,oneFieldAddressRow1:!0,orderFieldAddressRow1:"last-first",fullAddressCopyOrder:"address_row1;address_row2;address_row3;address_row4;address_row5;address_row6",language:"fr",lockFormRow6:!0,displayAddressLabel:!1,corpsProxy:"",distantDNSSolr:"https://api.laposte.fr/adviz-ca-fulltext/v1/",distantDNSMascadia:"https://api.laposte.fr/adviz-ca-postale/v1/",distantDQEAutocompletionMail:"https://api.laposte.fr/adviz-ca-mail-suggest/v1",distantDQEMail:"https://api.laposte.fr/adviz-controle-mail/v1",distantDQETelephone:"https://api.laposte.fr/adviz-ca-tel/v1"},a),e.append(f.fn.getHtmlForm(n)),f(".form-control").on("change input",function(e){e.target.value?e.target.classList.remove("empty"):e.target.classList.add("empty")}),n.doFullClipboardCopy?f("#btn_copy").show():f("#btn_copy").hide(),n.upperCaseFields&&f("form").find("input[type=input], input[type=password], textarea").each(function(){"address_row8"!==f(this).attr("id")&&f(this).addClass("uppercase")}),f.fn.lockForm=function(){f("form").find("input[type=input], input[type=password], textarea").each(function(){f.fn.inArray(f(this)[0].id.toString(),["address_row6","address_row1_first_name","address_row1_last_name","address_row1","address_row8","address_row9"])||f(this).prop("disabled",!0),f(this).addClass("empty"),f(this).removeClass("is-valid"),f(this).removeClass("is-invalid"),f(this).removeClass("is-warning"),f("#row8_message").hide(),f("#controler_votre_adresse").prop("disabled",!0)})},f.fn.unlockControle=function(){0!==f.trim(f("#address_row4").val()).length&&0!==f.trim(f("#address_row6").val()).length&&0!==f.trim(f("#address_row1_last_name").val()).length&&0!==f.trim(f("#address_row1_first_name").val()).length?f("#controler_votre_adresse").prop("disabled",!1):f("#controler_votre_adresse").prop("disabled",!0)},f("#address_row1_last_name,#address_row1_first_name").on("change input",f.fn.unlockControle),f.fn.unlockForm=function(){f("form").find("input[type=input], input[type=password], textarea").each(function(){f(this).prop("disabled",!1)})},f.fn.unlock_4_5_Form=function(){f("form").find("input[type=input], input[type=password], textarea").each(function(){f("#address_row4").prop("disabled",!1),f("#address_row5").prop("disabled",!1)}),f.fn.unlockControle()},f.fn.unlock_Bouton_Valider=function(){f("form").find("input[type=input], input[type=password], textarea").each(function(){f("#btn_validate").prop("disabled",!1)}),0!==f.trim(f("#address_row1_last_name").val()).length&&0!==f.trim(f("#address_row1_first_name").val()).length&&0!==f.trim(f("#address_row6").val()).length&&0!==f.trim(f("#address_row4").val()).length&&f("#btn_validate").prop("disabled",!1)},f.fn.lock_Bouton_Valider=function(){f("form").find("input[type=input], input[type=password], textarea").each(function(){f("#btn_validate").prop("disabled",!0)})},f.fn.unlock_2_3_Form=function(){f("form").find("input[type=input], input[type=password], textarea").each(function(){f("#address_row2").prop("disabled",!1),f("#address_row3").prop("disabled",!1)}),f.fn.unlockControle()},n.lockFormRow6?f.fn.lockForm():f.fn.unlockForm(),void 0!==n.backColor&&0<n.backColor.length&&f("#address-autocomplete-form").css("background-color",n.backColor),f("#btn_clear").click(function(){f.fn.updateFinal(!0),f.fn.lock_Bouton_Valider(),n.lockFormRow6&&(f.fn.lockForm(),f.fn.lock_Bouton_Valider())}),f("input[type=radio]").change(function(){f.fn.updateFinal()}),n.oneFieldAddressRow1?f("#address_row1").change(function(){f.fn.updateFinal()}):(f("#address_row1_first_name").change(function(){f.fn.updateFinal()}),f("#address_row1_last_name").change(function(){f.fn.updateFinal()})),f("#address_row2").change(function(){f.fn.updateFinal()}),f("#address_row3").change(function(){f.fn.updateFinal()}),f("#address_row5").change(function(){f.fn.updateFinal()}),f.widget("ui.autocomplete",f.ui.autocomplete,{_renderMenu:function(r,s){var o=this;void 0!==s&&f.each(s,function(e,a){o._renderItemData(r,a),e+1===s.length&&f('<li class="ui-state-disabled footer-autocomplete" id="SNAFooter"><a class="ui-state-disabled" target="_blank"><img class="ui-state-disabled" src="images/powered-by-laposte-on-white.png" alt="Avec La Poste"/></a></li>').appendTo(r).data("ui-autocomplete-item",a)})},_renderItemData:function(e,a){f(a.highlightedResult).appendTo(e).data("ui-autocomplete-item",a)}}),f("#address_row6").autocomplete({minLength:n.minLengthBeforeCall,autoFocus:!0,source:function(e,a){var r={object:f("#address_row6"),result:[],urlWS:f.fn.getSercaURL(f("#address_row6").val(),"address_row6",n)+s+o};a(f.fn.AjaxRetry(r,a))},select:function(e,a){return f("#address_row6").val(a.item.address_row6).change().attr("insee_code",a.item.insee_code).attr("libelle_acheminement",a.item.libelle_acheminement),f("#address_row5").val(a.item.address_row5).change(),n.displayAddressLabel&&(f.fn.updateFinal(),f.fn.unlock_4_5_Form()),!1},open:function(){f(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){f(this).removeClass("ui-corner-top").addClass("ui-corner-all")}}),f("#address_row5").autocomplete({minLength:n.minLengthBeforeCall,autoFocus:!0,source:function(e,a){var r={object:f("#address_row6"),result:[],urlWS:f.fn.getSercaURL(f("#address_row5").val(),"address_row5",n)+s+o};a(f.fn.AjaxRetry(r,a))},select:function(e,a){return f("#address_row6").val(a.item.address_row6).change().attr("insee_code",a.item.insee_code).attr("libelle_acheminement",a.item.libelle_acheminement),f("#address_row5").val(a.item.address_row5).change(),n.displayAddressLabel&&(f.fn.updateFinal(),f.fn.unlock_4_5_Form()),!1},open:function(){f(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){f(this).removeClass("ui-corner-top").addClass("ui-corner-all")}}),f("#address_row4").autocomplete({minLength:n.minLengthBeforeCall,autoFocus:!0,source:function(e,a){var r={object:f("#address_row4"),result:[],urlWS:f.fn.getSercaURL(f("#address_row4").val(),f.fn.getTypeAddressRow4(f("#address_row6").attr("libelle_acheminement")),n)+s+o};a(f.fn.AjaxRetry(r,a))},select:function(e,a){f("#address_row4").attr("voie",a.item.justVoieaddress_row4).attr("numext",a.item.numext),f("#address_row4").val(f.trim(a.item.numext+" "+a.item.justVoieaddress_row4)),f("#address_row5").val(a.item.address_row5).change(),f("#address_row6").val(a.item.address_row6).change(),n.displayAddressLabel&&f.fn.updateFinal(),f("#address_row3").autocomplete({minLength:0}).focus().autocomplete("search",""),e.preventDefault()},open:function(){f(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){f(this).removeClass("ui-corner-top").addClass("ui-corner-all"),n.displayAddressLabel&&(f.fn.updateFinal(),f.fn.unlock_2_3_Form())},change:function(){n.displayAddressLabel&&f.fn.updateFinal()}}),f("#address_row3").autocomplete({minLength:n.minLengthBeforeCall,autoFocus:!0,source:function(e,a){var r={object:f("#address_row3"),numero_address_row4:f("#address_row4").attr("numext"),result:[],urlWS:f.fn.getSercaURL(f("#address_row3").val(),"address_row3",n)+s+o};a(f.fn.AjaxRetry(r,a))},select:function(e,a){"-1"!==a.item.insee_code?(f("#address_row3").val(a.item.address_row3).attr("insee_code",a.item.insee_code).change(),f("#address_row4").val(a.item.address_row4).change(),f("#address_row5").val(a.item.address_row5).change(),f("#address_row6").val(a.item.address_row6).change()):f("#address_row3").val("").change(),n.displayAddressLabel&&f.fn.updateFinal(),13===e.which&&f("#address_row2").focus()},open:function(){f(this).removeClass("ui-corner-all").addClass("ui-corner-top"),n.displayAddressLabel&&f.fn.updateFinal()},close:function(){f(this).removeClass("ui-corner-top").addClass("ui-corner-all")},change:function(){n.displayAddressLabel&&f.fn.updateFinal()}}),f("#address_row8").autocomplete({minLength:n.minLengthBeforeCall,autoFocus:!0,source:function(e,a){var r={object:f("#address_row8"),result:[],urlWS:f.fn.getSercaURL(f("#address_row8_autocompletion").val(),"address_row8_autocompletion",n)};a(f.fn.AjaxRetryMailAuto(r,a))},select:function(e,a){return f("#address_row8").val(a.item.address_row8).change(),n.displayAddressLabel&&f.fn.updateFinal(),!1},open:function(){f(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){f(this).removeClass("ui-corner-top").addClass("ui-corner-all"),0<f("#address_row8").val().length&&f("#address_row8").autocomplete({minLength:0}).focus().autocomplete("search","")}}),f("#controler_votre_adresse").click(function(){f.fn.AjaxRetryMascadia({object:f("#controler_votre_adresse"),result:[],urlWS:f.fn.getSercaURL(f("#controler_votre_adresse").val(),"controler_votre_adresse",n)});var e=f("#address_row8").val();e&&f.fn.AjaxRetryMascadia({object:f("#address_row8"),result:[],urlWS:f.fn.getSercaURL(e,"controler_votre_mail",n)});var a=f("#address_row9").val();a&&f.fn.AjaxRetryMascadia({object:f("#address_row9"),result:[],urlWS:f.fn.getSercaURL(a,"controler_votre_telephone",n)}),f.fn.unlock_Bouton_Valider()}),f("#address_row4").blur(function(){f.fn.unlockControle(),f.fn.updateFinal()}),f("#address_row6").blur(function(){f.fn.unlockControle(),f.fn.updateFinal()}),f("input:checkbox").on("click",function(){var e=f(this);if(e.is(":checked")){var a="input:checkbox[name='"+e.attr("name")+"']";f(a).prop("checked",!1),e.prop("checked",!0)}else e.prop("checked",!1)}),e})}}(jQuery);
//# sourceMappingURL=jquery.serca-form.0.0.1.min.js.map